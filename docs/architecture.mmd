graph TB
    subgraph "Web Application (Next.js)"
        UI[User Interface]
        API[API Routes]
        DASH[Dashboard]
    end

    subgraph "Worker (Python)"
        AGENT[AI Agents]
        BACKTEST[Backtesting Engine]
        RAG[RAG System]
        RISK[Risk Engine]
    end

    subgraph "External Services"
        MILVUS[Milvus Vector DB]
        SNOWFLAKE[Snowflake Data Warehouse]
        BINANCE[Binance API]
        POLYGON[Polygon API]
    end

    subgraph "Data Flow"
        MARKET[Market Data]
        SIGNALS[Trading Signals]
        ORDERS[Order Execution]
    end

    %% Web to Worker communication
    UI --> API
    API --> AGENT
    API --> BACKTEST
    API --> RAG

    %% Worker to external services
    AGENT --> MILVUS
    RAG --> MILVUS
    BACKTEST --> SNOWFLAKE
    RISK --> SNOWFLAKE

    %% Market data flow
    BINANCE --> MARKET
    POLYGON --> MARKET
    MARKET --> BACKTEST
    MARKET --> AGENT

    %% Signal and order flow
    AGENT --> SIGNALS
    BACKTEST --> SIGNALS
    RISK --> SIGNALS
    SIGNALS --> ORDERS
    ORDERS --> BINANCE

    %% UI updates
    SIGNALS --> DASH
    ORDERS --> DASH

    classDef web fill:#e1f5fe
    classDef worker fill:#f3e5f5
    classDef external fill:#fff3e0
    classDef data fill:#e8f5e8

    class UI,API,DASH web
    class AGENT,BACKTEST,RAG,RISK worker
    class MILVUS,SNOWFLAKE,BINANCE,POLYGON external
    class MARKET,SIGNALS,ORDERS data 